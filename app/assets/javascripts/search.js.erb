
// Handle presence of Javascript by turning off or on visibility of JS sensitive objects
$(".js-disabled-object").css({"visibility": "hidden"});
$(".js-enabled-object").css({"visibility": "visible"});

    function update_collection_search_input(entry_id_target, sort, page, push_url) {

        //var target_url = '<#%= url_for(action: 'index') %>';
        var target_url = 'index';
        var params = 'entry_id_target=' + entry_id_target + '&page=' + page + '&sort=' + sort;

        if (history.pushState) {
            if (push_url) {
                var newurl = window.location.protocol + "//" + window.location.host + window.location.pathname + '?' + params;
                window.history.pushState({path: newurl}, '', newurl);
            }
        }

        $.ajax({
            type: 'GET',
            dataType: 'script',
            url: target_url,
            data: params
        });

        return false;
    }

    function getURLParameter(name) {
        return decodeURIComponent((new RegExp('[?|&]' + name + '=' + '([^&;]+?)(&|#|;|$)').exec(location.search)||[,""])[1].replace(/\+/g, '%20'))||null
    }

    // Handle "Back" button
    $(window).on("popstate", function () {
      // Refresh the contents page using AJAX. Extract & use the parameters from the "backed" url
      var page = getURLParameter("page");
      if (page != null) {
        update_collection_search_input(getURLParameter("entry_id_target") || '', getURLParameter("sort") || '', getURLParameter("page") || '', false);
      }
    });

    function go_to_page(page) {
        update_collection_search_input($('#entry_id_target').val(), $('#sort').val(), page, true);
    }

