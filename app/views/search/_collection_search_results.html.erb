<div class="pagination-summary">
  <%= page_entries_info @collections, entry_name: 'record' %>
</div>

<table id="search-results">
  <thead>
  <tr>
    <!-- Temporarily commented out because this is not a part of the MVP %-->
    <!--th><input type="checkbox" name="name" value=""></th-->
    <th class="w20">
      <%# Uncomment after CMR-2111 %>
      <%#= sort_by_link('Short Name', 'short_name', @query) %>
      Short Name
    </th>
    <th class="w10">
      <%#= sort_by_link('Version', 'version_id', @query) %>
      Version
    </th>
    <th class="w40"><%= sort_by_link('Entry Title', 'entry_title', @query) %></th>
    <th class="w15"><%= sort_by_link('Provider', 'provider_id', @query) %></th>
    <th class="w15"><%= sort_by_link('Last Modified', 'revision_date', @query) %></th>
  </tr>
  </thead>
  <tbody>

    <% @errors.each do |error| %>
      <tr>
        <td colspan="4">
          <strong>Error:</strong> <%= error %>
        </td>
      </tr>
    <% end %>

    <% if @collections.blank? %>
      <tr>
        <td colspan="4">
          No collections found
        </td>
      </tr>
    <% else %>

      <% @collections.each do |collection| %>
        <tr class='<%= cycle("alt", "") %>'>
          <!-- Temporarily commented out because this is not a part of the MVP %-->
          <!--td>
            <input type="checkbox" name="name" value="">
          </td-->
          <td>
            <% if collection['meta']['draft_id'] %>
              <% if @current_user.provider_id == collection['meta']['provider-id'] %>
                <%= link_to "#{collection['umm']['short-name']} (Draft)", draft_path(collection['meta']['draft_id'])%>
              <% elsif @current_user.available_providers.include?(collection['meta']['provider-id']) %>
                <%= link_to "#{collection['umm']['short-name']} (Draft)", '#not-current-provider-modal', class: 'display-modal not-current-provider', data: { 'provider': collection['meta']['provider-id'], record_action: 'edit-draft' } %>
                <div id="not-current-provider-modal" class="modal-content">
                  <a href="javascript:void(0);" class="modal-close float-r"><i class="fa fa-times"></i><span class="is-hidden">Close</span></a>
                  <p>
                    <span class="record-action"></span> requires you change your provider context to <span class="provider"></span>. Would you like to change your provider context and perform this action?
                  </p>
                  <p>
                    <a href="javascript:void(0)" class="btn btn-default modal-close">No</a>
                    <%= link_to 'Yes', '#', class: 'btn btn-blue spinner not-current-provider-link' %>
                    <%= link_to 'Yes', edit_draft_path(collection['meta']['draft_id']), class: 'btn btn-blue spinner is-hidden', id: 'not-current-provider-edit-draft-link' %>
                  </p>
                </div>
              <% end %>
            <% else %>
              <%= link_to collection['umm']['short-name'], collection_path(collection['meta']['concept-id'])%>
            <% end %>
          </td>
          <td>
            <%= collection['umm']['version-id']%>
          </td>
          <td>
            <%= collection['umm']['entry-title']%>
          </td>
          <td>
            <%= collection['meta']['provider-id']%>
          </td>
          <td>
            <% fragments = collection['meta']['revision-date'].split('T')
               date = fragments[0].nil? ? 'UNKNOWN' : fragments[0] %>
            <%= date %>
          </td>
        </tr>
      <% end %>

    <% end %>
  </tbody>
</table>

<%= paginate @collections, params: { search_type: @query['search_type'] } %>
