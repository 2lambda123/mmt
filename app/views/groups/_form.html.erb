<% new_form = params[:action] == 'new' || params[:action] == 'create' %>
<% path = new_form ? groups_path : group_path %>
<% method = new_form ? :post : :put %>

<%= form_tag(path, method: method, class: 'group-form') do %>
  <fieldset class="no-bg">
    <legend class="space-bot-sm">General</legend>
    <div class="row">
      <%= label_tag('group[name]', 'Group Name', class: 'icon-required') %>
      <br/>
      <%= text_field_tag('group[name]', @group['name'], class: 'half-width required', readonly: !new_form) %>
    </div>
    <div class="row">
      <%= label_tag('group[description]', 'Group Description', class: 'icon-required') %>
      <%= text_area_tag('group[description]', @group['description'], cols: 30, rows: 3, class: 'required') %>
    </div>
  </fieldset>
  <% if new_form %>
    <hr>
    <fieldset class="no-bg">
      <div class="row">
        <legend class="space-bot-sm">Add Members to Group</legend>
      </div>
      <label for="filter-members" class="disabled">Filter Members</label>
      <input type="text" id="filter-members" class="w30 disabled" placeholder="Enter user name" disabled/>
      <div class="dual-select">
        <div class="dual-select__menu">
          <%= label_tag('members_directory') %>
          <%= select_tag 'members_directory', options_for_user_select(@users_options), multiple: true %>
        </div>
        <div class="dual-select__actions">
          <button id="add-members" class="btn btn-default">
            Add Member(s)
            <span class="icon-circle-right"></span>
          </button>
          <button id="remove-members" class="btn btn-default">
            <span class="icon-circle-left"></span>
            Remove Member(s)
          </button>
        </div>
        <div class="dual-select__menu">
          <div class="row">
            <label for="selected_members">Selected Members</label>
          </div>
          <%= select_tag 'selected_members', options_for_user_select(@selected_users), multiple: true %>
        </select>
        </div>
      </div>
    </fieldset>
  <% end %>
  <div class="row space-top">
    <%= submit_tag 'Save', class: 'btn btn-blue space-right', id: 'new-group-submit' %>
    <% if new_form %>
      <%= link_to 'Cancel', groups_path %>
    <% else %>
      <%= link_to 'Cancel', group_path %>
    <% end %>
  </div>
<% end %>
