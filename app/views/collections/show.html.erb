<main class="internal record" role="main">
  <header>
    <div class="row content">
      <div class="collection-basics">
        <div class="breadcrumb">
          <ol>
            <li><%= link_to 'Dashboard', dashboard_path %></li>
            <li><%= display_entry_id(@collection, 'collection') %></li>
          </ol>
        </div>
        <h2><%= display_entry_id(@collection, 'collection') %></h2>
        <p class="subtitle"><%= display_collection_entry_title(@collection) %></p>
        <% unless @error %>
          <p class="subnav current">Published Record</p>
          <p class="subnav">
            <% if @current_user.provider_id == @provider_id %>
              <%= link_to 'Edit Record', edit_collection_path(revision_id: @revision_id)%>
            <% elsif @current_user.available_providers.include?(@provider_id) %>
              <%= link_to 'Edit Record', '#not-current-provider-modal', class: 'display-modal not-current-provider', data: { 'provider': @provider_id, collection_action: 'edit' } %>
            <% end %>
          </p>
        <% end %>
      </div>
      <div class="collection-details">
        <span class="badge version">Version <%= @collection["Version"]%></span>
        <!-- Only display data language if one exists. -->
        <% if @collection["DataLanguage"] %>
          <span class="badge language"><%= @collection["DataLanguage"]%></span>
        <% end %>
        <% if @collection["CollectionDataType"] == "NEAR_REAL_TIME" %>
          <span class="badge nrt">NRT</span>
        <% end %>
        <div class="quality-score disabled">
          <div class="badges">
            <i class="fa fa-star fa-lg"></i>
            <i class="fa fa-star fa-lg"></i>
            <i class="fa fa-star fa-lg"></i>
            <i class="fa fa-star fa-lg"></i>
            <i class="fa fa-star-o fa-lg"></i>
          </div>
          <div class="score-info">
            <p>Quality Score: <strong>20</strong></p>
            <p>Required fields not complete</p>
          </div>
        </div>
      </div>
    </div>
  </header>

  <%= render 'shared/flash_messages' %>

  <% if @old_revision %>
    <div class="banner banner-info">
      <%= link_to 'You are viewing an older revision of this collection. Click here to view the latest published version.', collection_path %>
    </div>
  <% end %>

  <div class="row row-content">
    <% if @error %>
      <div class="banner banner-info">
        <p>
          <%= @error %>
        </p>
      </div>
    <% else %>
      <section class="action">
        <div class="cta">
          <p>
            <a class="disabled" href="#">Save as Template</a> |
            <% if @current_user.provider_id == @provider_id %>
              <%= link_to 'Clone this Record', clone_collection_path %> |
            <% elsif @current_user.available_providers.include?(@provider_id) %>
              <%= link_to 'Clone this Record', '#not-current-provider-modal', class: 'display-modal not-current-provider', data: { 'provider': @provider_id, collection_action: 'clone' } %> |
            <% end %>
            <a class="display-modal download-xml" href="#download-xml-modal" data-path="<%= @collection_link %>" data-token="<%= token_with_client_id %>">Download XML</a>
            <% if @current_user.provider_id == @provider_id %>
              | <%= link_to 'Delete Record', "#delete-record-modal", class: 'display-modal delete-collection' %>
            <% elsif @current_user.available_providers.include?(@provider_id) %>
              | <%= link_to 'Delete Record', '#not-current-provider-modal', class: 'display-modal not-current-provider', data: { 'provider': @provider_id, collection_action: 'delete' } %>
            <% end %>
            <div id="delete-record-modal" class="modal-content">
              <a href="javascript:void(0);" class="modal-close float-r"><i class="fa fa-times"></i><span class="is-hidden">Close</span></a>
              <p>Are you sure you want to delete this record?</p>
              <p>
                <a href="javascript:void(0)" class="btn btn-default modal-close">No</a>
                <%= link_to 'Yes', collection_path, method: :delete, class: 'btn btn-blue spinner' %>
              </p>
            </div>
            <div id="not-current-provider-modal" class="modal-content">
              <a href="javascript:void(0);" class="modal-close float-r"><i class="fa fa-times"></i><span class="is-hidden">Close</span></a>
              <p>
                <span class="collection-action"></span> requires you change your provider context to <span class="provider"></span>. Would you like to change your provider context and perform this action?
              </p>
              <p>
                <a href="javascript:void(0)" class="btn btn-default modal-close">No</a>
                <%= link_to 'Yes', '#', class: 'btn btn-blue spinner not-current-provider-link' %>
                <%= link_to 'Yes', edit_collection_path(revision_id: @revision_id), class: 'btn btn-blue spinner is-hidden', id: 'not-current-provider-edit-link' %>
                <%= link_to 'Yes', clone_collection_path, class: 'btn btn-blue spinner is-hidden', id: 'not-current-provider-clone-link' %>
                <%= link_to 'Yes', collection_path, method: :delete, class: 'btn btn-blue spinner is-hidden', id: 'not-current-provider-delete-link' %>
              </p>
            </div>

            <!-- Hidden link to allow modal to be shown -->
            <a href="#granules-modal" id="display-granules-modal" class="display-modal is-hidden"></a>
            <div id="granules-modal" class="modal-content">
              <a href="javascript:void(0);" class="modal-close float-r"><i class="fa fa-times"></i><span class="is-hidden">Close</span></a>
              <p>Collections with granules cannot be deleted</p>
              <p>
                <a href="javascript:void(0)" class="btn btn-default modal-close">Ok</a>
              </p>
            </div>

          </p>
          <p>
            <%= link_to "Revisions (#{@revisions.size})", collection_revisions_path %> |
            <a class="collection-granule-count disabled" href="#">Granules (<%= @num_granules %>)</a>
          </p>
        </div>
        <%= render partial: 'shared/download_xml', locals: { collection: true } %>

      </section>

      <%= render partial: 'shared/preview/metadata_preview', locals: { metadata: @collection } %>
    <% end %>
  </div>
</main>
