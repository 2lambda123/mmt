<main class="internal record">
  <header>
    <div class="content">
      <div class="breadcrumb">
        <ol>
          <li><%= link_to 'Manage Metadata Dashboard', dashboard_path %></li>
          <li><%= link_to @draft.display_entry_title, draft_path(@draft) %></li>
        </ol>
      </div>
      <h2>
        <%= image_tag('collection.png', alt: 'Sun') %> <%= @draft.display_entry_title %></h2>
      <p class="subtitle">Draft Record</p>
    </div>
  </header>
  <section class="action">
    <div class="cta">
      <a href="#" alt="Publish Button" class="btn btn-blue">Publish</a>
      <a href="#" alt="Download XML">Download XML</a> |
      <%= link_to 'Delete Draft', @draft, method: :delete, data: { confirm: 'Are you sure you want to delete this record?' } %>
    </div>
    <div class="quality-score">
      <div class="badges">
        <%= image_tag('badge.png', alt: 'Badge') %>
        <%= image_tag('badge.png', alt: 'Badge') %>
        <%= image_tag('badge.png', alt: 'Badge') %>
        <%= image_tag('badge.png', alt: 'Badge') %>
        <%= image_tag('badge.png', alt: 'Badge') %>
      </div>
      <div class="score-info">
        <p>Quality Score = 20</p>
        <p>Required fields not complete</p>
      </div>
    </div>
  </section>
  <section class="metadata">
    <h3>Metadata Fields</h3>
    <ul>
      <li>
        <div class="status">
          <i class="fa fa-circle-thin"></i>
        </div>
        <div class="meta-info">
          <%= link_to 'Data Identification', draft_edit_form_path(@draft, 'data_identification') %>
          <br>
          <i class="fa fa-circle"></i><i class="fa fa-circle-o"></i><i class="fa fa-circle"></i><i class="fa fa-circle-o icon-grey"></i><i class="fa fa-circle"></i><i class="fa fa-circle-o"></i><i class="fa fa-circle"></i><i class="fa fa-circle-o"></i>
        </div>
      </li>
      <li>
        <div class="status">
          <i class="fa fa-circle-thin"></i>
        </div>
        <div class="meta-info">
          <%= link_to 'Descriptive Keywords', draft_edit_form_path(@draft, 'descriptive_keywords') %>
          <br>
          <i class="fa fa-circle icon-grey"></i><i class="fa fa-circle-o"></i><i class="fa fa-circle"></i><i class="fa fa-circle-o"></i><i class="fa fa-circle"></i><i class="fa fa-circle-o icon-grey"></i><i class="fa fa-circle"></i><i class="fa fa-circle-o"></i>
        </div>
      </li>
      <li>
        <div class="status">
          <i class="fa fa-circle-thin"></i>
        </div>
        <div class="meta-info">
          <%= link_to 'Metadata Information', draft_edit_form_path(@draft, 'metadata_information') %>
          <br>
          <i class="fa fa-circle"></i><i class="fa fa-circle-o icon-grey"></i><i class="fa fa-circle"></i><i class="fa fa-circle-o"></i><i class="fa fa-circle"></i><i class="fa fa-circle-o icon-grey"></i><i class="fa fa-circle"></i><i class="fa fa-circle-o"></i>
        </div>
      </li>
      <li>
        <div class="status">
          <i class="fa fa-check-circle"></i>
        </div>
        <div class="meta-info">
          <%= link_to 'Temporal Extent', draft_edit_form_path(@draft, 'temporal_extent') %>
          <br>
          <i class="fa fa-circle"></i><i class="fa fa-circle-o"></i><i class="fa fa-circle"></i><i class="fa fa-circle-o icon-grey"></i><i class="fa fa-circle"></i><i class="fa fa-circle-o"></i><i class="fa fa-circle"></i><i class="fa fa-circle-o"></i>
        </div>
      </li>
      <li>
        <div class="status">
          <i class="fa fa-circle-thin"></i>
        </div>
        <div class="meta-info">
          <%= link_to 'Spatial Extent', draft_edit_form_path(@draft, 'spatial_extent') %>
          <br>
          <i class="fa fa-circle"></i><i class="fa fa-circle-o"></i><i class="fa fa-circle"></i><i class="fa fa-circle-o icon-grey"></i><i class="fa fa-circle"></i><i class="fa fa-circle-o"></i><i class="fa fa-circle icon-grey"></i><i class="fa fa-circle-o icon-grey"></i>
        </div>
      </li>
      <li>
        <div class="status">
          <i class="fa fa-circle-thin"></i>
        </div>
        <div class="meta-info">
          <%= link_to 'Acquisition Information', draft_edit_form_path(@draft, 'acquisition_information') %>
          <br>
          <i class="fa fa-circle"></i><i class="fa fa-circle-o icon-grey"></i><i class="fa fa-circle"></i><i class="fa fa-circle-o"></i><i class="fa fa-circle"></i><i class="fa fa-circle-o"></i><i class="fa fa-circle"></i><i class="fa fa-circle- icon-grey"></i>
        </div>
      </li>
      <li>
        <div class="status">
          <i class="fa fa-check-circle"></i>
        </div>
        <div class="meta-info">
          <%= link_to 'Distribution Information', draft_edit_form_path(@draft, 'distribution_information') %>
          <br>
          <i class="fa fa-circle icon-grey"></i><i class="fa fa-circle-o"></i><i class="fa fa-circle"></i><i class="fa fa-circle-o icon-grey"></i><i class="fa fa-circle"></i><i class="fa fa-circle-o"></i><i class="fa fa-circle"></i><i class="fa fa-circle-o"></i>
        </div>
      </li>
    </ul>
  </section>

  <div class="row content">
    <section class="preview">

      <h3>Preview</h3>
      <input type="checkbox" name="markdown"></input>
      <label for="markdown">Show as markdown</label>

      <%= render :partial=>'drafts/previews/data_identification', :locals=>{:draft=>@draft.draft} %>
      <%= render :partial=>'drafts/previews/descriptive_keywords', :locals=>{:draft=>@draft.draft} %>
      <%= render :partial=>'drafts/previews/metadata_information', :locals=>{:draft=>@draft.draft} %>
      <%= render :partial=>'drafts/previews/temporal_extent', :locals=>{draft: @draft.draft} %>
      <%= render :partial=>'drafts/previews/spatial_extent', :locals=>{draft: @draft.draft} %>
      <%= render :partial=>'drafts/previews/acquisition_information', :locals=>{:draft=>@draft.draft} %>
      <%= render :partial=>'drafts/previews/distribution_information', :locals=>{:draft=>@draft.draft} %>

    </section>
    <aside class="geographic-coverage">
      <h3>Geographic Coverage</h3>
      <%= image_tag("plate_carree_earth@2x.png", alt:'Map', id:'preview_map') %>

      <caption>Spatial Coordinates</caption>
      <ol class="coordinates" id="coordinates"></ol>

      <h4>Location Keywords</h4>
      <ul id="location_keywords">
      </ul>
      <h4>Temporal Coverage</h4>
      <ul id="temporal_coverage">
      </ul>
    </aside>
  </div>

  <script>
    var preview_map = $('#preview_map');
    var position = preview_map.offset();
    var map_x1 = position.left;
    var map_y1 = position.top;
    var coordinate_html = '';
    var temporal_coverage_html = '';

    var map_width = preview_map.width();
    var map_height = preview_map.height();
    var highlight_color = "rgba(250,0,0,0.25)"

    function convert_lat_lon(lat, lon){ // Do a simple transformation to map lat/lon onto y/x of map image
      var y = ((-1 * lat) + 90) * (map_height / 180);
      var x = (180 + lon) * (map_width / 360);
      return {x:x,y:y};
    }

    <% if @draft.draft['SpatialExtent'] &&
          @draft.draft['SpatialExtent']['HorizontalSpatialDomain'] &&
          @draft.draft['SpatialExtent']['HorizontalSpatialDomain']['Geometry'] &&
          @draft.draft['SpatialExtent']['HorizontalSpatialDomain']['Geometry']['CoordinateSystem'] %>

      <% geometry = @draft.draft['SpatialExtent']['HorizontalSpatialDomain']['Geometry'] %>

      <% if geometry['Points'] %>

        var dot_size = 5;
        function draw_point(x, y) {
          var dot = '<div style="position:absolute;width:' + dot_size + 'px;height:' + dot_size + 'px;top:' + y + 'px;left:' + x + 'px;background:' + highlight_color +'"></div>';
          document.body.innerHTML += dot;
        }
        <% geometry['Points'].each do |point| %>
            var converted_lat_lon = convert_lat_lon(<%= point['Latitude'] %>, <%= point['Longitude'] %>);
            draw_point(converted_lat_lon.x + map_x1, converted_lat_lon.y + map_y1);

            coordinate_html +=  "<li>Lat: <%= point['Latitude'] %></li> \
                                <li>Lon: <%= point['Longitude'] %></li></br>";  // TODO - UI dev - remove </br>
        <% end %>

      <% elsif geometry['BoundingRectangles'] %>

        function draw_rectangle(x1, y1, x2, y2) {
          var min_x = Math.min(x1, x2);
          var max_x = Math.max(x1, x2);
          var min_y = Math.min(y1, y2);
          var max_y = Math.max(y1, y2);
          var rect = '<div style="position:absolute;width:' + (max_x-min_x) + 'px;height:' + (max_y-min_y) + 'px;top:' + min_y + 'px;left:' + min_x + 'px;background:' + highlight_color +'"></div>';
          document.body.innerHTML += rect;
        }

        <% geometry['BoundingRectangles'].each do |bounding_rectangle| %>
          var converted_lat_lon_1 = convert_lat_lon(<%=bounding_rectangle['NorthBoundingCoordinate']%>,
                                                    <%=bounding_rectangle['WestBoundingCoordinate']%>);
          var converted_lat_lon_2 = convert_lat_lon(<%=bounding_rectangle['SouthBoundingCoordinate']%>,
                                                    <%=bounding_rectangle['EastBoundingCoordinate']%>);
    alert (converted_lat_lon_1.x);
    alert (converted_lat_lon_1.y);
          draw_rectangle( converted_lat_lon_1.x + map_x1,
                          converted_lat_lon_1.y + map_y1,
                          converted_lat_lon_2.x + map_x1,
                          converted_lat_lon_2.y + map_y1 );

          coordinate_html +=  "<li>N: <%=bounding_rectangle['NorthBoundingCoordinate']%></li> \
                              <li>S: <%=bounding_rectangle['SouthBoundingCoordinate']%></li> \
                              <li>E: <%=bounding_rectangle['EastBoundingCoordinate']%></li> \
                              <li>W: <%=bounding_rectangle['WestBoundingCoordinate']%></li></br>"; // TODO - UI dev - remove </br>
        <% end %>

      <% end %>
    <% end %>

    var coordinates = document.getElementById("coordinates");
    coordinates.innerHTML = coordinate_html;


    location_keywords_html = "<li>Continent > Antartica</li> \
                              <li>Geographic Region > Polar</li>";
    var location_keywords = document.getElementById("location_keywords");
    location_keywords.innerHTML = location_keywords_html;


    <% if !@draft.draft['TemporalExtents'].nil? %>
      <% @draft.draft['TemporalExtents'].each do |temporal_extent| %>

        <% if temporal_extent['TemporalRangeType'] == 'SingleDateTime' %>

          <% temporal_extent['SingleDateTimes'].each do |single_date_time| %>
            temporal_coverage_html += '<li>Date: <%= single_date_time%></li></br>'; // TODO - UI dev - remove </br>
          <% end %>

        <% elsif temporal_extent['TemporalRangeType'] == 'RangeDateTime' %>

          <% temporal_extent['RangeDateTimes'].each do |range_date_time| %>
            temporal_coverage_html += '<li>Start Date: <%= range_date_time['BeginningDateTime']%> </li> \
                                       <li>Stop Date: <%= range_date_time['EndingDateTime']%> </li></br>'; // TODO - UI dev - remove </br>
          <% end %>

        <% elsif temporal_extent['TemporalRangeType'] == 'PeriodicDateTime' %>

          <% temporal_extent['PeriodicDateTimes'].each do |periodic_date_time| %>
            temporal_coverage_html += '<li>Start Date: <%= periodic_date_time['StartDate']%> </li> \
                                       <li>Stop Date: <%= periodic_date_time['EndDate']%> </li></br>'; // TODO - UI dev - remove </br>
          <% end %>

        <% end %>

      <% end %>
    <% end %>

    var temporal_coverage = document.getElementById("temporal_coverage");
    temporal_coverage.innerHTML = temporal_coverage_html;


  </script>


</main>
