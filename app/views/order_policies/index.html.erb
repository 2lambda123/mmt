<main class="internal" role="main">
  <header>
    <div class="content">
      <div class="eui-breadcrumbs">
        <ol class="eui-breadcrumbs__list">
          <li class="eui-breadcrumbs__item">
            <%= link_to 'Manage CMR', manage_cmr_path %>
          </li>
          <li class="eui-breadcrumbs__item">Order Policies</li>
        </ol>
      </div>
    </div>
  </header>

  <%= render 'shared/flash_messages' %>

  <div class="row row-content">
    <section>
      <h2><%= @current_user.provider_id %> Order Policies</h2>

      <% if @policy.empty? %>

        <p>No <%= @current_user.provider_id %> Order Policies found.</p>
        <%= link_to 'Create Order Policies', new_order_policies_path, class: 'eui-btn' %>

      <% else %>

        <article class="order-policy">
          <div class="row-content flex-row--sb">
            <!-- RETRY INFORMATION -->
            <div class="content-box">
              <h3>Retry Information</h3>
              <p><span class="inline-label">Retry Attempts:</span> <%= @policy.fetch('RetryAttempts') %></p>
              <p><span class="inline-label">Retry Wait Time:</span> <%= @policy.fetch('RetryWaitTime') %></p>
            </div>

            <!-- ROUTING LOCATION -->
            <div class="content-box">
              <h3>Routing Location</h3>
              <p><span class="inline-label">End Point:</span> <%= @policy.fetch('EndPoint') %></p>
              <p><span class="inline-label">Type:</span> <%= @policy.fetch('Routing') %></p>
              <p><span class="inline-label">Suspend Ordering Until:</span> <%= @policy.fetch('SuspendOrderingUntil', 'Ordering Not Suspended') %></p>
            </div>

            <!-- TRANSACTIONS SUPPORTED -->
            <div class="content-box">
              <h3>Order Transactions Supported</h3>
              <%= [*@policy.fetch('SupportedTransactions', {}).fetch('Item', [])].to_sentence %>

              <p><span class="inline-label">Override Status Notifications:</span> <%= @policy.fetch('overrideNotificationEnabled', 'false').downcase == "true" ? "Yes" : "No" %></p>
            </div>
          </div>

          <table>
            <thead>
              <tr>
                <th class="table-header-span" colspan="3">Order Catalog Options</th>
              </tr>
              <tr>
                <th>Short Name</th>
                <th>Version</th>
                <th>Entry Title</th>
              </tr>
            </thead>
            <tbody>
              <% if @policy.key?('CollectionsSupportingDuplicateOrderItems') %>
                <% [*@policy.fetch('CollectionsSupportingDuplicateOrderItems', {}).fetch('Item', [])].each do |collection| %>
                  <tr>
                    <td><%= collection %></td>
                    <td>Version Placeholder</td>
                    <td>Shortname Placeholder</td>
                  </tr>
                <% end %>
              <% end %>
            </tbody>
          </table>
          <p><span class="inline-label">Maximum Items Per Order:</span> <%= @policy.fetch('MaxItemsPerOrder', 'No Maximum') %></p>

          <h3>SSL Policy</h3>
          <p>
            <span class="inline-label">Status:</span>
             <%= @policy.fetch('SslPolicy', {}).fetch('SslEnabled', 'false') == "true" ? 'Enabled' : 'Disabled' %></p>
          <p>
            <span class="inline-label">Last Updated:</span>
             <%= @policy.fetch('SslPolicy', {}).fetch('SslLastUpdate') %></p>

          <h3>Custom Properties</h3>
          <% if @policy.key?('Properties') %>
            <pre><%= @pretty_properties %></pre>
          <% end %>

          <%= link_to 'Edit Order Policies', edit_order_policies_path, class: 'eui-btn' %>
        </article>

      <% end %>
    </section>
  </div>
</main>