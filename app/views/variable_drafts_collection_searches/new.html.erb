<% content_for :header_title do %>
  <h2>Collection Association Search</h2>
<% end %>

<div class="umm-form variable-form">
  <div class="row row-content">
    <section>
      <h3>Collection Association Search</h3>

      <fieldset class="variable-draft-selected-collection-association">
        <h4>Currently Selected Collection</h4>
        <table id="variable-draft-collection-association-table">
          <thead>
            <tr>
              <th>Entry Title</th>
              <th>Short Name</th>
              <th>Version</th>
            </tr>
          </thead>

          <tbody>
            <tr>
              <% if @draft.collection_concept_id.present? && @current_collection_info %>
              <td><%= link_to @current_collection_info.dig('umm', 'entry-title'), collection_path(@current_collection_info.dig('meta', 'concept-id')) %></td>
              <td><%= @current_collection_info.dig('umm', 'short-name') %></td>
              <td><%= @current_collection_info.dig('umm', 'version-id') %></td>
              <% elsif @current_collection_error %>
              <td colspan="4"><%= @current_collection_error %></td>
              <% else %>
              <td colspan="4">No Collection Association found. A Collection must be selected in order to publish this Variable Draft.</td>
              <% end %>
            </tr>
          </tbody>
        </table>

        <% unless @draft.collection_concept_id.blank? %>
          <%# TODO: When clearing a collection association, the value becomes an empty string. should that change? %>
          <%= button_to 'Clear Collection Association', update_associated_collection_variable_draft_path(@draft), method: :post, params: { selected_collection: nil }, class: 'eui-btn eui-btn--red'  %>
        <% end %>

        <%# console %>

        <%# add local to each for a cancel button? %>
        <%# will need to a path to return to also probably %>
      </fieldset>

      <%= render partial: 'cmr_search/shared/search_form', locals: { submit_path: collection_search_variable_draft_path, allow_cancel: true, cancel_path: variable_draft_path } %>

      <%= render partial: 'cmr_search/shared/search_results', locals: { collections: @collections, use_radio_buttons: true, submit_path: update_associated_collection_variable_draft_path, submit_text: 'Submit', use_spinner: false, allow_cancel: true, cancel_path: variable_draft_path } %>
    </section>
  </div>
</div>
