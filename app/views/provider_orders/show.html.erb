<div class="row row-content">
  <section>
    <h2>Provider Order</h2>

    <table>
      <tbody>
        <tr>
          <td>Order Guid:</td>
          <td><%= @provider_order['guid'] %></td>
        </tr>
        <tr>
          <td>Provider ID:</td>
          <td><%= @provider_order['provider_id'] %></td>
        </tr>
        <tr>
          <td>Tracking ID:</td>
          <td><%= @provider_order['tracking_id'] %></td>
        </tr>
        <tr>
          <td>Provider Order State:</td>
          <td><%= @provider_order['provider_order_state'] %></td>
        </tr>
        <tr>
          <td>Closed Date:</td>
          <td><%= @provider_order['closed_date'] %></td>
        </tr>
      </tbody>
    </table>

    <h3>Catalog Items</h3>
    <table id="catalog-items-table">
      <thead>
        <tr>
          <th>Catalog Item</th>
          <th>Status</th>
          <th>Data Granule ID</th>
          <th>Local Granule ID</th>
          <th>Option Selection</th>
        </tr>
      </thead>
      <tbody>
        <% @provider_order['catalog_items'].each do |catalog_item| %>
          <tr>
            <td><%= catalog_item['item_guid'] %></td>
            <td><%= catalog_item['status'] %></td>
            <td><%= catalog_item['data_granule_id'] %></td>
            <td><%= catalog_item['local_granule_id'] %></td>
            <td>
              <%= catalog_item['option_selection']['name'] %>
              <%= link_to 'show/hide', 'javascript:void(0);', class: 'show-option-selection' %>
              <div class="option-selection-content is-hidden">
                <textarea name="option-selection-<%= catalog_item['item_guid'] %>" cols="75" rows="18" readonly="readonly">
                  <%= catalog_item['option_selection']['content'].strip %>
                </textarea>
              </div>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>

    <h3>Status Messages</h3>
    <ul>
      <% @provider_order['status_messages'].each do |message| %>
        <li><%= message %></li>
      <% end %>
    </ul>

    <h3>Receipt</h3>
    <table>
      <tbody>
        <tr>
          <td>Acceptance Date:</td>
          <td><%= @provider_order['receipt']['acceptance_date'] %></td>
        </tr>
        <tr>
          <td>Estimated Ship Date:</td>
          <td><%= @provider_order['receipt']['estimated_ship_date'] %></td>
        </tr>
        <tr>
          <td>Last Cancel Date:</td>
          <td><%= @provider_order['receipt']['latest_cancel_date'] %></td>
        </tr>
      </tbody>
    </table>

    <%= link_to 'Cancel Order', '#cancel-provider-order-modal', class: 'display-modal eui-btn eui-btn--red' %>
    <div id="cancel-provider-order-modal" class="eui-modal-content">
      <a href="javascript:void(0);" class="modal-close float-r"><i class="fa fa-times"></i><span class="is-invisible">Close</span></a>

      <h3>Cancel Provider Catalog Items</h3>
      <%= form_tag(provider_order_path, method: :delete, id: "cancel-provider-order-form") do %>
        <%= hidden_field_tag 'provider_tracking_id', @provider_order['tracking_id'] %>

        <fieldset>
          <div class="row">
            <label for="order_guid">Order Guid</label>
            <%= text_field_tag 'order_guid', @provider_order['guid'], class: 'full-width', readonly: true %>
          </div>
        </fieldset>

        <fieldset>
          <div class="row">
            <label for="provider_guid">Provider Guid</label>
            <%= text_field_tag 'provider_guid', @provider_order['provider_guid'], class: 'full-width', readonly: true %>
          </div>
        </fieldset>

        <fieldset>
          <div class="row">
            <label for="catalog_items">Catalog Items</label>
            <%= select_tag 'catalog_items', options_for_select(@provider_order['catalog_items'].select { |item| !['CANCELLED', 'CLOSED'].include? item['status'] }.map { |item| item['item_guid'] }, nil), class: 'full-width', multiple: true %>
          </div>
        </fieldset>

        <fieldset>
          <div class="row">
            <label for="status_message">Status Message</label>
            <%= text_field_tag 'status_message', nil, class: 'full-width' %>
          </div>
        </fieldset>

        <fieldset>
          <%= submit_tag 'Cancel Items', class: 'eui-btn eui-btn--red' %>
          <%= submit_tag 'Close Items', class: 'eui-btn eui-btn--red' %>
        </fieldset>
      <% end %>
    </div>
  </section>
</div>
