<main class="internal" role="main">
  <header>
    <div class="content">
      <div class="eui-breadcrumbs">
        <ol class="eui-breadcrumbs__list">
          <li class="eui-breadcrumbs__item"><%= link_to 'Manage CMR', manage_cmr_path %></li>
          <li class="eui-breadcrumbs__item"><%= link_to 'Order Option Assignments', order_option_assignments_path %></li>
        </ol>
      </div>
    </div>
  </header>

  <%= render 'shared/flash_messages' %>

  <div class="row row-content">
    <section>
      <h2>Order Option Assignments</h2>

      <%= form_tag(new_order_option_assignment_path, method: :get, id: 'show-order-option-assignments-form') %>

      <%= check_box_tag 'show-no-assigned-options', id: 'show-no-assigned-options'%>
      <%= label_tag 'show-no-assigned-options', 'Include selected collections with no assigned options?' %>
      <table id="collections-table">
        <thead>
          <tr>
            <th>
              <%= check_box_tag 'order-option-all-checkbox[]' %>
            </th>
            <th>
              Collection
            </th>
            <th>
              Short Name
            </th>
            <th>
              Version ID
            </th>
            <th>
              Option Definition Name
            </th>
            <th>

            </th>
          </tr>
        </thead>

        <tbody>
          <%@collections_to_list.each do |collection| %>
              <%
                option_def = collection.fetch('option-def',{})
                option_def_name = ''

                if option_def.class.to_s == "Hash"
                  option_def_name = option_def.fetch('Name','')
                else
                  option_def_name = ''
                end

                disp_class = option_def_name.blank? ? 'class=hidden-row' : ''
              %>
              <tr <%=disp_class%>>
                <td>
                  <%= check_box_tag 'order-option-checkbox[]', collection['umm']['entry-title'] %>
                </td>
                <td>
                  <%=collection['umm']['entry-title']%>
                </td>
                <td>
                  <%=collection['umm']['short-name']%>
                </td>
                <td>
                  <%=collection['umm']['version-id']%>
                </td>
                <td>
                  <%=option_def_name %>
                </td>
                <td>
                  <% if ! option_def_name.blank? %>
                    <%= link_to 'View',  order_option_assignment_url({
                      :entry_title => collection['umm']['entry-title'],
                      :option_def_name => collection.fetch('option-def',{}).fetch('Name', ''),
                      :filter_xpath => collection['option-assignment-filter-xpath']
                      }
                    ) %>
                  <% end %>

                </td>
              </tr>
          <%end %>
        </tbody>
      </table>

      <%= submit_tag 'Add New Option Assignment', id: 'add-submit-button', class: 'eui-btn--green' %>
      <%= link_to 'Cancel', order_option_assignments_path %>

    </section>
  </div>
</main>
